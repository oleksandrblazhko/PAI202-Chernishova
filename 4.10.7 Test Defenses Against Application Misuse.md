# 4.10.7 Тестувальні засоби захисту від неправильного використання програми (англ. Test Defenses Against Application Misuse)

<table>
    <thead>
       <tr>
        <th><b>ID</b> </th>
        </tr>
    </thead>
 <tbody>
        <tr>
<td> WSTG-BUSL-07</td>
         </tr> 
    </tbody>
</table>


## Загальні положення
Неправильне та недійсне використання дійсних функцій може виявити атаки, які намагаються маніпулювати веб-програму, виявити слабкі та використати вразливі місця. Тому необхідно провести тестування, щоб визначити, чи існують захисні механізми прикладного рівня для захисту програми.

Відсутність активного захисту дозволяє зловмиснику шукати вразливі місця без жодних засобів захисту. Таким чином, власник програми не знатиме, що його програма атакувана.

### Приклад
Такі дії, наприклад, малоймовірні для автентифікованого користувача:
1.	Спроба отримати доступ до ідентифікатора файлу, завантаження якого не дозволено ролі користувача
2.	Заміна однієї позначки ' замість ідентифікаційного номера файлу
3.	Зміна запиту GET на POST
4.	Додання додаткового параметру
5.	Дублювання пари ім’я/значення параметра

Програма відстежує зловживання та реагує після 5-ї дії з надзвичайно високою впевненістю, що користувач є зловмисником. Наприклад, додаток може:

1.	Відключити критичні функції
2.	Вмикнути додаткові кроки автентифікації для інших функцій
3.	Додати часові затримки в кожен цикл запит-відповідь
4.	Почати записувати додаткові дані про взаємодію користувача (наприклад, дезінфіковані заголовки та тіла запитів HTTP, тіла відповіді)
Якщо програма жодним чином не відповідає, а зловмисник може продовжувати зловживати функціями та надсилати явно шкідливий вміст у програму, програма не пройшла тестування. На практиці дискретні приклади дій як у списку вище навряд чи відбуватимуться таким чином. Набагато ймовірніше, для визначення слабких місць використується нечіткий інструмент , що аналізує кожен параметр по черзі. Це те, з чим також стикається тестувальник безпеки.
## Цілі тестування
* Створюйте нотатки з усіх тестів, проведених над системою. 
* Перегляньте, які тести мали інші функції на основі агресивного введення параметрів.
* Проналізуйте наявні засоби захисту та перевірте, чи достатньо їх для захисту системи від обхідних методів.

## Методи тестування
Тест у даному випадку незвичайний тим, що результат можна отримати з усіх інших тестів, проведених щодо веб-програми. Виконуючи всі інші тести, зверніть увагу на заходи, які можуть свідчити про те, що програма має вбудований самозахист. Такими заходами можуть бути: 
* Змінені відповіді
* Заблоковані запити
* Дії, які виводять користувача з системи або блокують його обліковий запис

Дані заходи можна строго локалізувати. Загально локалізованими (для кожної функції) засобами захисту виступають, наприклад, такі: 

* Відхилення введення параметрів, що містять певні символи
* Тимчасове блокування облікового запису після кількох помилок автентифікації

Локальних заходів безпеки недостатньо. Вони не передбачають часто засобів захисту від загального неправильного використання, наприклад, у таких випадках:
* Примусовий веб-перегляд сторінок
* Обхід перевірки вхідних даних на рівні презентування
* Велика кількість помилок контролю доступу
* Додаткові, дубльовані або відсутні імена параметрів
* Багато помилок під час перевірки введених параметрів або перевірки бізнес-логіки зі значеннями, які не можуть бути результатом помилок користувача або друкарських помилок
* Отримання структурованих даних (наприклад, JSON, XML) недійсного формату
* Отримання відвертого міжсайтового скриптингу або SQL-ін’єкції
* Швидкість використання програми вище, ніж це було б можливо без засобів автоматизації
* Зміна континентальної геолокації користувача
* Зміна агента користувача
* Доступ до багатоетапного бізнес-процесу в неправильному порядку
* Велика кількість або високий рівень використання специфічних для програми функцій (наприклад, надсилання коду ваучера, невдалі платежі кредитною карткою, скачування файлів, завантаження файлів, вихід із системи тощо).

Засоби захисту найкраще працюють у автентифікованих частинах програми, хоча швидкість створення нових облікових записів або доступу до вмісту (наприклад, для збирання інформації) може бути корисною у відкритих для користувачів місцях.
Не все з вищезазначеного потребує моніторингу програм, але виникає проблема, якщо жодний захід не перевіряється. Під час тестування веб-програми, виконуючи вищезазначені дії, треба перевірити, чи було вжито будь-якої дії проти тестувальника. Якщо ні, тестувальник повинен повідомити, що програма, схоже, не має активного захисту всієї програми від зловживання. Зауважте, що іноді можливо, що всі відповіді на виявлення атак залишаються закритими для користувача (наприклад, реєстрація змін, посилений моніторинг, сповіщення адміністраторів і запит проксі-сервера), тому впевненість у цьому висновку не може бути гарантована. На практиці існує дуже небагато програм (або відповідної інфраструктури, як-от мережевий екран веб-програм), що виявляють такі типи зловживання.

## Релевантне тестування
Усі тести актуальні.

## Санація
Програми мають реалізовувати активний захист, щоб захистити себе від зловмисників і порушників.

## Посилання
* Software Assurance, US Department Homeland Security
* IR 7684 Common Misuse Scoring System (CMSS), NIST
* Common Attack Pattern Enumeration and Classification (CAPEC), The Mitre Corporation
* OWASP AppSensor Project
* AppSensor Guide v2, OWASP
* Watson C, Coates M, Melton J and Groves G, Creating Attack-Aware Software Applications with Real-Time Defenses, CrossTalk The Journal of Defense Software Engineering, Vol. 24, No. 5, Sep/Oct 2011* CWE-840: Business Logic Errors
